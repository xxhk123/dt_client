#!/bin/bash

if [[ $(id -u) != 0 ]]; then
	clear
    whiptail --title "é”™è¯¯ä¿¡æ¯" --msgbox "è¯·åœ¨rootç”¨æˆ·ä¸‹æ‰§è¡Œ" 8 78 
	exit 1
fi

if [[ $(uname -m 2> /dev/null) != x86_64 ]]; then
	clear
    whiptail --title "é”™è¯¯ä¿¡æ¯" --msgbox "è¯·åœ¨64ä½ç³»ç»Ÿä¸‹è¿è¡Œæ­¤è„šæœ¬" 8 78 
	exit 1
fi

#æ“ä½œç³»ç»Ÿåˆ¤æ–­
osdist(){

    set -e
    if cat /etc/*release | grep ^NAME | grep -q Debian; then

        dist=debian
        apt-get update -q
        export DEBIAN_FRONTEND=noninteractive
        apt-get install whiptail curl locales lsb-release jq dnsutils lsof -y -qq

    else
        clear
        whiptail --title "é”™è¯¯ä¿¡æ¯" --msgbox "æœ¬è„šæœ¬åªèƒ½åœ¨debian10ä¸‹è¿è¡Œ" 8 78     
        exit 1; 
    fi
}

dt_system_dep(){

rm -rf /etc/apt/sources.list.d/*
cat << EOF > /etc/apt/sources.list
deb http://mirrors.aliyun.com/debian $(cat /etc/os-release | grep VERSION= | cut -d '(' -f2 | cut -d ')' -f1) main
deb http://mirrors.aliyun.com/debian-security $(cat /etc/os-release | grep VERSION= | cut -d '(' -f2 | cut -d ')' -f1)/updates main
deb http://mirrors.aliyun.com/debian $(cat /etc/os-release | grep VERSION= | cut -d '(' -f2 | cut -d ')' -f1)-updates main
EOF

groupadd clash
useradd -g clash -d /home/clash -s /bin/bash -m clash

echo clash | sudo passwd clash --stdin  &>/dev/null

apt update

echo iptables-persistent iptables-persistent/autosave_v4 boolean true | debconf-set-selections
echo iptables-persistent iptables-persistent/autosave_v6 boolean true | debconf-set-selections

yes|apt -y install sudo supervisor iptables-persistent net-tools curl gzip unzip

source /etc/profile

echo "clash  ALL=(ALL:ALL) ALL" >> /etc/sudoers

cat << EOF > /etc/sysctl.conf

net.ipv4.ip_forward=1
fs.file-max = 999999

net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.core.rmem_default = 6291456
net.core.wmem_default = 6291456
net.core.netdev_max_backlog = 65535
net.core.somaxconn = 262114

net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_max_tw_buckets = 5000
net.ipv4.tcp_mem = 8192 131072 67108864
net.ipv4.tcp_rmem = 10240 87380 12582912
net.ipv4.tcp_wmem = 10240 87380 12582912
net.ipv4.tcp_mtu_probing = 1
net.ipv4.tcp_notsent_lowat = 16384
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_max_orphans= 262114
net.ipv4.tcp_fastopen = 3

net.ipv4.ip_local_port_range = 1024 65000

net.ipv4.udp_mem = 8192 131072 67108864
net.ipv4.udp_rmem_min = 4096
net.ipv4.udp_wmem_min = 4096
net.core.default_qdisc = fq
net.ipv4.tcp_congestion_control = bbr
EOF

sysctl -p
}

#trojan
dt_input_trojan(){
while [[ -z ${loc_ip} ]]; do
    loc_ip=$(whiptail --inputbox --nocancel "è¾“å…¥æœ¬æœºIPï¼ˆç°åœ¨å®‰è£…ç¯å¡”å®¢æˆ·ç«¯æœºå™¨çš„ipï¼‰" 8 78 --title "è¾“å…¥åŸŸå" 3>&1 1>&2 2>&3)
done

while [[ -z ${gate_ip} ]]; do
    gate_ip=$(whiptail --inputbox --nocancel "è¾“å…¥ç½‘å…³IPï¼ˆè¾“å…¥ç½‘å…³IPï¼ˆrosçš„ipæˆ–è€…çˆ±å¿«ipï¼‰" 8 78 --title "è¾“å…¥åŸŸå" 3>&1 1>&2 2>&3)
done

# gate_ip=$(route -n | grep $ETH_N | grep UG | awk '{print $2}')

}


dt_smartdns(){

wget --no-check-certificate -O /opt/smartdns.deb $SM

cd /opt
dpkg -i smartdns.deb

cat << EOF > /etc/smartdns/smartdns.conf
bind :55
bind :56 -no-speed-check -group GFW -no-rule-addr
speed-check-mode tcp:443,tcp:80,ping
cache-size 0
rr-ttl 600
rr-ttl-min 60
rr-ttl-max 600
prefetch-domain yes
force-AAAA-SOA yes
serve-expired yes
serve-expired-ttl 0
log-level error
log-file /var/log/smartdns.log
log-size 2048k
log-num 2
conf-file /etc/smartdns/gfw_domain.conf

server 119.28.28.28
server 223.5.5.5
server 223.6.6.6 
server-tls dns.rubyfish.cn:853
server-tcp 8.8.8.8 -group GFW -exclude-default-group
server-tcp 8.8.4.4 -group GFW -exclude-default-group
server-tls dns.rubyfish.cn:853 -group GFW -exclude-default-group 
EOF

rm -rf /opt/smartdns.deb

cd /etc/smartdns/

wget --no-check-certificate $GFW_LIST

cd 

systemctl enable smartdns
systemctl start smartdns > /dev/null 2>&1

}

#trojan
dt_clash_trojan(){

wget --no-check-certificate -O /opt/clash.gz $CLS
cd /opt

gzip -d clash.gz
mv clash /usr/local/bin/clash
chmod +x /usr/local/bin/clash
# ä¸º clash æ·»åŠ ç»‘å®šä½ä½ç«¯å£çš„æƒé™ï¼Œè¿™æ ·è¿è¡Œ clash çš„æ—¶å€™æ— éœ€ root æƒé™
setcap cap_net_bind_service=+ep /usr/local/bin/clash

mkdir -p /home/clash/.config/clash

cat << EOF > /home/clash/.config/clash/config.yaml
port: 7890
socks-port: 7891
redir-port: 7892
allow-lan: true
mode: Rule
log-level: info
external-controller: 0.0.0.0:9090
dns:
  enable: true
  listen: 0.0.0.0:53
  enhanced-mode: redir-host
  nameserver:
    - 127.0.0.1:55
  fallback:
    - 127.0.0.1:56
secret: miyue
external-ui: dashboard
Proxy:

Proxy Group:
  - name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies:
      - ğŸ¯ å…¨çƒç›´è¿
  - name: ğŸ¯ å…¨çƒç›´è¿
    type: select
    proxies:
      - DIRECT
  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    type: select
    proxies:
      - ğŸ¯ å…¨çƒç›´è¿
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
Rule:
 - DOMAIN-SUFFIX,local,ğŸ¯ å…¨çƒç›´è¿
 - IP-CIDR,192.168.0.0/16,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - IP-CIDR,10.0.0.0/8,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - IP-CIDR,172.16.0.0/12,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - IP-CIDR,127.0.0.0/8,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - IP-CIDR,100.64.0.0/10,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - IP-CIDR6,::1/128,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - IP-CIDR6,fc00::/7,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - IP-CIDR6,fe80::/10,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - IP-CIDR6,fd00::/8,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - DOMAIN,app.adjust.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,googletraveladservices.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,dl.google.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,mtalk.google.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,livew.l.qq.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,vd.l.qq.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,analytics.strava.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,msg.umeng.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,msg.umengcloud.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,qhres.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,qhimg.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,akadns.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,alibaba.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,alicdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,alikunlun.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,alipay.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,amap.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,autonavi.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,dingtalk.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,mxhichina.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,soku.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,taobao.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,tmall.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,tmall.hk,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ykimg.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,youku.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,xiami.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,xiami.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,aaplimg.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,apple.co,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,apple.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,apple-cloudkit.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,appstore.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,cdn-apple.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,crashlytics.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,icloud.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,icloud-content.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,me.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,mzstatic.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,www-cdn.icloud.com.akadns.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,baidu.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,baidubcr.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,bdstatic.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,yunjiasu-cdn.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,acgvideo.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,biliapi.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,biliapi.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,bilibili.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,bilibili.tv,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,hdslb.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,blizzard.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,battle.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,blzddist1-a.akamaihd.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,feiliao.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,pstatp.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,snssdk.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,iesdouyin.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,toutiao.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,cctv.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,cctvpic.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,livechina.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,didialift.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,didiglobal.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,udache.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,343480.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,baduziyuan.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,com-hs-hkdy.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,czybjz.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,dandanzan.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,fjhps.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,kuyunbo.club,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,21cn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,hitv.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,mgtv.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,iqiyi.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,iqiyipic.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,71.am.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,jd.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,jd.hk,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,jdpay.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,360buyimg.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,iciba.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ksosoft.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,meitu.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,meitudata.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,meitustat.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,meipai.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,duokan.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,mi-img.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,miui.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,miwifi.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,xiaomi.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,microsoft.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,msecnd.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,office365.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,outlook.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,s-microsoft.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,visualstudio.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,windows.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,windowsupdate.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,officecdn-microsoft-com.akamaized.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,163.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,126.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,127.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,163yun.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,lofter.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,netease.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ydstatic.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sina.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,weibo.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,weibocdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sohu.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sohucs.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sohu-inc.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,v-56.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sogo.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sogou.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sogoucdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,steampowered.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,steam-chat.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,steamgames.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,steamusercontent.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,steamcontent.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,steamstatic.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,steamcdn-a.akamaihd.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,steamstat.us,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,gtimg.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,idqqimg.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,igamecj.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,myapp.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,myqcloud.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,qq.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,servicewechat.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,tencent.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,tencent-cloud.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,tenpay.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,file-igamecj.akamaized.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,jstucdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zimuzu.io,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zimuzu.tv,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zmz2019.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zmzapi.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zmzapi.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zmzfile.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ccgslb.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ccgslb.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,chinanetcenter.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,meixincdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ourdvs.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,staticdn.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,wangsu.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ipip.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ip.la,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ip-cdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ipv6-test.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,test-ipv6.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,whatismyip.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,netspeedtestmaster.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,speedtest.macpaw.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,awesome-hd.me,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,broadcasthe.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,chdbits.co,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,classix-unlimited.co.uk,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,empornium.me,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,gazellegames.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,hdchina.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,hdsky.me,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,icetorrent.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,jpopsuki.eu,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,keepfrds.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,madsrevolution.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,m-team.cc,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,nanyangpt.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ncore.cc,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,open.cd,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ourbits.club,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,passthepopcorn.me,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,privatehd.to,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,redacted.ch,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,springsunday.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,tjupt.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,totheglory.im,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,acm.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,acs.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,aip.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ams.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,annualreviews.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,aps.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ascelibrary.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,asm.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,asme.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,astm.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,bmj.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,cambridge.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,cas.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,clarivate.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ebscohost.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,emerald.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,engineeringvillage.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,icevirtuallibrary.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ieee.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,imf.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,iop.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,jamanetwork.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,jhu.edu,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,jstor.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,karger.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,libguides.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,madsrevolution.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,mpg.de,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,myilibrary.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,nature.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,oecd-ilibrary.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,osapublishing.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,oup.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ovid.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,oxfordartonline.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,oxfordbibliographies.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,oxfordmusiconline.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,pnas.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,proquest.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,rsc.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sagepub.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sciencedirect.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sciencemag.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,scopus.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,siam.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,spiedigitallibrary.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,springer.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,springerlink.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,tandfonline.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,un.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,uni-bielefeld.de,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,webofknowledge.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,westlaw.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,wiley.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,worldbank.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,worldscientific.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,cn,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,360in.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,51ym.me,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,8686c.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,abchina.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,accuweather.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,aicoinstorge.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,air-matters.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,air-matters.io,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,aixifan.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,amd.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,b612.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,bdatu.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,beitaichufang.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,bjango.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,booking.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,bstatic.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,cailianpress.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,camera360.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,chinaso.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,chua.pro,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,chuimg.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,chunyu.mobi,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,chushou.tv,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,cmbchina.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,cmbimg.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ctrip.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,dfcfw.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,docschina.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,douban.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,doubanio.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,douyu.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,dxycdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,dytt8.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,eastmoney.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,eudic.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,feng.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,fengkongcloud.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,frdic.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,futu5.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,futunn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,gandi.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,geilicdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,getpricetag.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,gifshow.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,godic.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,hicloud.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,hongxiu.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,hostbuf.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,huxiucdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,huya.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,infinitynewtab.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ithome.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,java.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,jidian.im,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,kaiyanapp.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,kaspersky-labs.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,keepcdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,kkmh.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,licdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,linkedin.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,loli.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,luojilab.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,maoyan.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,maoyun.tv,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,meituan.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,meituan.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,mobike.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,moke.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,mubu.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,myzaker.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,nim-lang-cn.org,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,nvidia.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,oracle.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,paypal.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,paypalobjects.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,qdaily.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,qidian.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,qyer.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,qyerstatic.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,raychase.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ronghub.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ruguoapp.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,s-reader.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sankuai.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,scomper.me,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,seafile.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sm.ms,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,smzdm.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,snapdrop.net,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,snwx.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,sspai.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,takungpao.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,teamviewer.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,tianyancha.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,udacity.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,uning.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,vmware.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,weather.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,weico.cc,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,weidian.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,xiachufang.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,ximalaya.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,xinhuanet.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,xmcdn.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,yangkeduo.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zhangzishi.cc,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zhihu.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zhimg.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-SUFFIX,zhuihd.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,download.jetbrains.com,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN,images-cn.ssl-images-amazon.com,ğŸ¯ å…¨çƒç›´è¿
 - IP-CIDR,119.28.28.28/32,ğŸ¯ å…¨çƒç›´è¿,no-resolve
 - DOMAIN-SUFFIX,smtp,ğŸ¯ å…¨çƒç›´è¿
 - DOMAIN-KEYWORD,aria2,ğŸ¯ å…¨çƒç›´è¿
 - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿
 - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
EOF

cd /home/clash/.config/clash

wget --no-check-certificate $MMDB

mkdir dashboard

wget --no-check-certificate $DASH

unzip clash-dashboard-gh-pages.zip

mv clash-dashboard-gh-pages/* dashboard/

chown -R clash /home/clash/.config/

chmod +x /home/clash/.config/clash/Country.mmdb

cat << EOF > /lib/systemd/system/clash@.service
[Unit]
Description=A rule based proxy in Go for %i.
After=network.target

[Service]
Type=simple
User=%i
Restart=on-abort
ExecStart=/usr/local/bin/clash

[Install]
WantedBy=multi-user.target
EOF


systemctl daemon-reload

systemctl enable clash@clash

systemctl start clash@clash > /dev/null 2>&1

sleep 5
}


dt_iptables(){

temp_ip=(${loc_ip//./ })

jy_ip=${temp_ip[0]}"."${temp_ip[1]}".0.0"

iptables -t nat -N clash
echo "1******************************************************************"
iptables -t nat -N clash_dns
echo "2******************************************************************"
iptables -t nat -A PREROUTING -p tcp --dport 53 -d $jy_ip/16 -j clash_dns
echo "3******************************************************************"
iptables -t nat -A PREROUTING -p udp --dport 53 -d $jy_ip/16 -j clash_dns
echo "4******************************************************************"
iptables -t nat -A PREROUTING -p tcp -j clash
echo "5******************************************************************"

iptables -t nat -A clash_dns -p udp --dport 53 -d $jy_ip/16 -j DNAT --to-destination $loc_ip:53
# iptables -t nat -A PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 53
# iptables -t nat -A PREROUTING -p tcp --dport 53 -j REDIRECT --to-ports 53
echo "6******************************************************************"
iptables -t nat -A clash_dns -p tcp --dport 53 -d $jy_ip/16 -j DNAT --to-destination $loc_ip:53
echo "7******************************************************************"
#æ³¨æ„ï¼šè¿™é‡Œçš„ç½‘æ®µå’ŒIPä½ éœ€è¦è‡ªå·±é€‚é…è‡ªå·±çš„
iptables -t nat -A clash -d 0.0.0.0/8 -j RETURN
iptables -t nat -A clash -d 10.0.0.0/8 -j RETURN
iptables -t nat -A clash -d 127.0.0.0/8 -j RETURN
iptables -t nat -A clash -d 169.254.0.0/16 -j RETURN
iptables -t nat -A clash -d 172.16.0.0/12 -j RETURN
iptables -t nat -A clash -d 192.168.0.0/16 -j RETURN
iptables -t nat -A clash -d 224.0.0.0/4 -j RETURN
iptables -t nat -A clash -d 240.0.0.0/4 -j RETURN
echo "8******************************************************************"
# iptables -t nat -A clash -p tcp --dport 22 -d $loc_ip/24 -j ACCEPT
# -A PREROUTING -p tcp -m multiport --sports 443,3389,1194 -j RETURN
iptables -t nat -I PREROUTING -p tcp -m multiport --sports 443,1194,3128,3389,3690,5000,5001 -j RETURN
iptables -t nat -A clash -p tcp -j REDIRECT --to-ports 7892
echo "9******************************************************************"
iptables -t nat -A OUTPUT -p tcp -m owner ! --uid-owner clash -j REDIRECT --to-port 7892
echo "10******************************************************************"
netfilter-persistent save
echo "11******************************************************************"
netfilter-persistent start
echo "12******************************************************************"
iptables-save  > /etc/iptables/rules.v4
echo "13******************************************************************"
}


set_ip_dns(){

cat << EOF > /etc/network/interfaces
source /etc/network/interfaces.d/*

auto lo

auto  $ETH_N
iface $ETH_N inet static
  address $loc_ip
  netmask 255.255.255.0
  gateway $gate_ip
EOF

echo "14******************************************************************"
}

dt_menu() {
 Mainmenu=$(whiptail --clear --ok-button "ç¡®å®š" --backtitle "version:20200405v1" --title "ç¯å¡”å®¢æˆ·ç«¯v4.2" --menu --nocancel "
**********************************************************************************
ç®€ä»‹ï¼šç¯å¡”å®¢æˆ·ç«¯v4.2(æœ€ç®€å•çš„å®‰è£… æœ€ç®€å•çš„ä½¿ç”¨)
ç³»ç»Ÿï¼šDebian10
Youtubeï¼šç±³æœˆã€Unicom
ç”µæŠ¥ç¾¤ï¼šhttps://t.me/mi_yue
Youtubeé¢‘é“åœ°å€ï¼šhttps://t.im/n21o
**********************************************************************************
è¯·é€‰æ‹©éœ€è¦å®‰è£…çš„å†…å®¹ï¼š
    " 22 86 5\
        "1" " å®‰è£…ç¯å¡”å®¢æˆ·ç«¯"\
        "2" " é€€å‡º" 3>&1 1>&2 2>&3)
    case $Mainmenu in
        1)
        dt_system_dep
        dt_input_trojan
        dt_smartdns
        dt_clash_trojan
        dt_iptables
        set_ip_dns
        whiptail --title "ç¯å¡”å®¢æˆ·ç«¯å®‰è£…æˆåŠŸ" --msgbox "
*************************************************************************
ç¯å¡”å®¢æˆ·ç«¯å®‰è£…æˆåŠŸï¼ŒæŠŠéœ€è¦ç•™å­¦æœºå™¨çš„ç½‘å…³å’Œdnsæ”¹æˆç¯å¡”å®¢æˆ·ç«¯ipã€‚è½¯è·¯ç”±è¯·è‡ªè¡Œä¿®æ”¹ã€‚

ç¯å¡”å®¢æˆ·ç«¯IPï¼š$loc_ip
Youtubeï¼šç±³æœˆã€Unicom
ç”µæŠ¥ç¾¤ï¼šhttps://t.me/mi_yue
Youtubeé¢‘é“åœ°å€ï¼šhttps://t.im/n21o
ç¯å¡”webé¡µé¢:http://$loc_ip:9090/ui/
DNSä¸Šæ¸¸ä¿®æ”¹åœ°å€ï¼š/etc/smartdns/smartdns.conf
ç¯å¡”å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶åœ°å€ï¼š/home/clash/.config/clash/config.yaml
*************************************************************************" 18 78
        clear
        ;;
        2)
        #exit
        clear
        whiptail --title "è„šæœ¬å·²é€€å‡º" --msgbox "çœŸå¸Œæœ›æŠŠä½ ç•™ä½" 8 78
        ;;
        esac
}

ETH_N=$(ip --oneline link show up | grep -v "lo" | awk '{print$2;exit}' | cut -d':' -f1 | cut -d'@' -f1)
GFW_LIST="https://storage.rinvay.co/Smartdns/gfw_domain.conf"
SM="https://storage.rinvay.co/Smartdns/smartdns.1.2020.02.25-2212.x86_64-debian-all.deb"
CLS="https://storage.rinvay.co/Clash/clashr-linux-amd64-v0.19.0.1.gz"
DASH="https://storage.rinvay.co/Clash/clash-dashboard-gh-pages.zip"
MMDB="https://storage.rinvay.co/Clash/Country.mmdb"

dt_menu
